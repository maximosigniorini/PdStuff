#N canvas 60 85 439 535 10;
#X obj 42 240 hsl 128 15 0 1 0 0 \$0-amount empty compander-amount
20 8 0 10 -262144 -260097 -1 0 0;
#N canvas 110 283 356 302 testsignals 0;
#X obj 44 18 inlet;
#X obj 173 23 inlet;
#X obj 29 265 outlet~;
#X obj 44 138 line~;
#X obj 29 227 *~;
#X obj 44 89 t b b;
#X msg 74 166 0.25;
#X obj 44 61 metro 500;
#X obj 152 119 *~ 0;
#X obj 29 191 osc~ 100;
#X obj 173 92 * 0.01;
#X obj 252 23 inlet;
#X obj 210 164 adc~;
#X obj 231 195 *~ 0;
#X obj 152 62 noise~;
#X msg 44 113 1.1 \, 0 300;
#X connect 0 0 7 0;
#X connect 1 0 10 0;
#X connect 3 0 4 1;
#X connect 4 0 2 0;
#X connect 5 0 15 0;
#X connect 5 1 6 0;
#X connect 6 0 9 1;
#X connect 7 0 5 0;
#X connect 8 0 2 0;
#X connect 9 0 4 0;
#X connect 10 0 8 1;
#X connect 11 0 13 1;
#X connect 12 0 13 0;
#X connect 12 1 13 0;
#X connect 13 0 2 0;
#X connect 14 0 8 0;
#X connect 15 0 3 0;
#X restore 24 163 pd testsignals;
#X obj 24 102 tgl 15 1 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 64 120 tgl 15 1 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 48 441 hsl 128 15 0 1 0 0 empty empty audio-level 20 8 0 10
-262144 -260097 -1 0 0;
#X obj 24 463 *~ 0;
#X floatatom 59 463 5 0 0 0 - - -;
#X obj 24 490 dac~;
#X text 41 100 sine resonator 100 Hz;
#X obj 23 13 cnv 15 300 60 empty empty empty 20 12 0 14 -233017 -66577
0;
#X text 35 34 Katja Vetter 2010;
#X text 35 53 www.katjaas.nl/compander/compander.html;
#X text 21 77 test signals:;
#X obj 105 140 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X text 125 138 adc~;
#X obj 24 218 *~ 1;
#X obj 48 190 hsl 128 15 1 2 0 1 empty empty pre-gain 20 8 0 10 -262144
-260097 -1 0 0;
#X floatatom 58 218 5 0 0 0 - - -;
#N canvas 208 230 450 300 scope 0;
#X obj 55 193 inlet~;
#X obj 245 242 block~ 8192;
#X obj 70 220 bang~;
#X obj 55 244 tabwrite~ \$0-scope2;
#X obj 100 50 cnv 15 200 100 empty empty empty 20 12 0 14 -203904 -66577
0;
#N canvas 515 81 484 385 (subpatch) 0;
#X array \$0-scope2 8192 float 0;
#X coords 0 1 8191 -1 200 100 1 0 0;
#X restore 100 50 graph;
#X connect 0 0 3 0;
#X connect 2 0 3 0;
#X coords 0 -1 1 1 200 100 2 100 50;
#X restore 213 404 pd scope;
#X msg 352 39 \; pd dsp 1;
#X msg 352 78 \; pd dsp 0;
#X obj 72 321 hsl 128 15 0 1 0 0 empty empty decay 20 8 0 10 -262144
-260097 -1 0 0;
#X obj 24 387 qompand~;
#X msg 141 370 bypass \$1;
#X obj 141 346 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X text 84 119 white noise -40 dB;
#N canvas 388 223 450 300 scope 0;
#X obj 55 193 inlet~;
#X obj 55 244 tabwrite~ \$0-scope;
#X obj 245 242 block~ 8192;
#X obj 70 220 bang~;
#X obj 100 50 cnv 15 200 100 empty empty empty 20 12 0 14 -203904 -66577
0;
#N canvas 515 81 484 385 (subpatch) 0;
#X array \$0-scope 8192 float 0;
#X coords 0 1 8191 -1 200 100 1;
#X restore 100 50 graph;
#X connect 0 0 1 0;
#X connect 3 0 1 0;
#X coords 0 -1 1 1 200 100 2 100 50;
#X restore 214 180 pd scope;
#X obj 57 279 hsl 128 15 -18 -6 0 1 \$0-dBpoint empty dBpoint 20 8
0 10 -262144 -260097 -1 12700 0;
#N canvas 689 225 284 365 postgain 0;
#X obj 20 17 inlet~;
#X obj 20 307 outlet~;
#X floatatom 142 222 5 0 0 0 - - -;
#X obj 90 178 * 1;
#X obj 90 96 + 18;
#X floatatom 135 139 5 0 0 0 - - -;
#X obj 90 122 / 12;
#X obj 90 148 t b f;
#X obj 90 205 + 0.5;
#X obj 42 70 * 0.5;
#X obj 42 43 r \$0-amount;
#X obj 90 71 r \$0-dBpoint;
#X obj 20 276 *~ 1;
#X obj 90 259 line 1 2;
#X floatatom 90 284 5 0 0 0 - - -;
#X text 20 332 Psycho-acoustic amplitude compensation;
#X floatatom 178 88 5 0 0 0 - - -;
#X msg 90 231 \$1 50;
#X connect 0 0 12 0;
#X connect 3 0 8 0;
#X connect 4 0 6 0;
#X connect 6 0 5 0;
#X connect 6 0 7 0;
#X connect 7 0 3 0;
#X connect 7 1 3 1;
#X connect 8 0 2 0;
#X connect 8 0 17 0;
#X connect 9 0 3 0;
#X connect 10 0 9 0;
#X connect 11 0 4 0;
#X connect 11 0 16 0;
#X connect 12 0 1 0;
#X connect 13 0 12 1;
#X connect 13 0 14 0;
#X connect 17 0 13 0;
#X restore 24 415 pd postgain;
#X obj 352 14 loadbang;
#X obj 215 88 cnv 15 100 40 empty empty empty 20 12 0 14 -260097 -66577
0;
#N canvas 334 32 448 506 more-info 0;
#X obj 221 257 hradio 200 1 0 1 empty empty empty 0 -8 0 10 -228856
-228856 -1 0;
#N canvas 0 22 450 278 (subpatch) 0;
#X array \$0-rms-curve 512 float 2;
#X coords 0 1 511 0 200 200 1 0 0;
#X restore 221 257 graph;
#X text 205 458 0;
#X text 417 461 1;
#X text 202 250 1;
#X text 174 352 output;
#X floatatom 29 354 5 0 0 0 - - -;
#X text 280 461 input rms;
#X text 28 99 The effect of compression in the upper part of the amplitude
scale and expansion in the lower part \, is that loud components become
louder (till the limiter point) and soft components become softer.
With proper tuning of parameter dBpoint to;
#X floatatom 28 441 5 0 0 0 - - -;
#N canvas 663 397 178 185 dB-from-adc~ 0;
#X obj 23 135 outlet;
#X obj 23 70 env~ 8192;
#X obj 23 39 adc~;
#X obj 23 101 - 100;
#X connect 1 0 3 0;
#X connect 2 0 1 0;
#X connect 2 1 1 0;
#X connect 3 0 0 0;
#X restore 28 414 pd dB-from-adc~;
#X text 29 178 Set your input gain in such a way that all the wanted
sounds are above parameter dBpoint and the unwanted sounds (noise \,
speaker feedback etc.) are below dBpoint.;
#X text 27 21 [qompand~] converts a real input signal to complex \,
and calculates instantaneous amplitudes. The amplitude envelope is
taken and mapped to a desired amplitude curve as shown in the plot.
Everything above 1 is limited to unity amplitude.;
#X obj 29 272 r \$0-amount;
#X obj 104 304 r \$0-dBpoint;
#X text 65 354 rms point;
#X floatatom 115 330 5 0 0 0 - - -;
#X floatatom 36 296 5 0 0 0 - - -;
#N canvas 673 74 320 493 draw-curve 0;
#X obj 51 152 until;
#X obj 51 101 t b b;
#X msg 51 126 512;
#X obj 51 207 f;
#X obj 82 206 + 1;
#X msg 66 178 0;
#X obj 51 11 inlet;
#X obj 165 12 inlet;
#X obj 165 36 t b f;
#N canvas 987 123 186 278 amount 0;
#X obj 37 43 inlet;
#X obj 37 71 clip 0 1;
#X obj 96 114 t b f;
#X msg 96 142 1;
#X obj 96 175 -;
#X obj 37 210 outlet;
#X obj 96 210 outlet;
#X text 96 234 curve;
#X text 36 232 line;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 0 5 0;
#X connect 2 0 3 0;
#X connect 2 1 4 1;
#X connect 3 0 4 0;
#X connect 4 0 6 0;
#X restore 78 72 pd amount;
#N canvas 79 277 298 328 exponent 0;
#X obj 27 28 inlet;
#X obj 27 291 outlet;
#X obj 27 57 clip -18 -6;
#X obj 27 110 dbtorms;
#X text 117 184 1.5708 = pi/2;
#X floatatom 49 135 5 0 0 0 - - -;
#X obj 27 83 + 100;
#X text 89 134 rms;
#X obj 106 291 outlet;
#X text 153 290 rms;
#X obj 27 183 log;
#X obj 62 210 sin;
#X obj 62 236 log;
#X text 95 218 log(rms)/log(sin(rms*(pi/2)));
#X obj 27 157 t f f;
#X obj 62 184 * 1.5708;
#X obj 27 261 /;
#X connect 0 0 2 0;
#X connect 2 0 6 0;
#X connect 3 0 5 0;
#X connect 3 0 14 0;
#X connect 3 0 8 0;
#X connect 6 0 3 0;
#X connect 10 0 16 0;
#X connect 11 0 12 0;
#X connect 12 0 16 1;
#X connect 14 0 10 0;
#X connect 14 1 15 0;
#X connect 15 0 11 0;
#X connect 16 0 1 0;
#X restore 192 70 pd exponent;
#X obj 51 336 sin;
#X obj 51 257 / 512;
#X obj 51 308 * 1.57079;
#X text 115 306 pi/2;
#X obj 51 362 pow;
#X obj 51 390 *;
#X obj 114 390 *;
#X obj 51 46 t b f;
#X floatatom 192 102 5 0 0 0 - - -;
#X obj 51 420 +;
#X obj 51 233 t f f;
#X obj 51 281 t f f;
#X obj 255 447 outlet;
#X text 91 10 amount;
#X text 208 13 dBpoint;
#X obj 51 449 tabwrite \$0-rms-curve;
#X text 137 389 linear;
#X text 74 391 curve;
#X connect 0 0 3 0;
#X connect 1 0 2 0;
#X connect 1 1 5 0;
#X connect 2 0 0 0;
#X connect 3 0 4 0;
#X connect 3 0 21 0;
#X connect 4 0 3 1;
#X connect 5 0 3 1;
#X connect 6 0 18 0;
#X connect 7 0 8 0;
#X connect 8 0 1 0;
#X connect 8 1 10 0;
#X connect 9 0 16 1;
#X connect 9 1 17 1;
#X connect 10 0 19 0;
#X connect 10 0 15 1;
#X connect 10 1 23 0;
#X connect 11 0 15 0;
#X connect 12 0 22 0;
#X connect 13 0 11 0;
#X connect 15 0 16 0;
#X connect 16 0 20 0;
#X connect 17 0 20 1;
#X connect 18 0 1 0;
#X connect 18 1 9 0;
#X connect 20 0 26 0;
#X connect 21 0 12 0;
#X connect 21 1 26 1;
#X connect 22 0 13 0;
#X connect 22 1 17 0;
#X restore 29 329 pd draw-curve;
#X connect 10 0 9 0;
#X connect 13 0 18 0;
#X connect 13 0 17 0;
#X connect 14 0 18 1;
#X connect 14 0 16 0;
#X connect 18 0 6 0;
#X restore 226 100 pd more-info;
#X text 33 14 quadrature compressor/expander/limiter for Pd;
#X obj 50 259 nbx 4 14 -1e+37 1e+37 0 0 empty empty empty 0 -8 0 10
-262144 -1 -1 0 256;
#X obj 65 300 nbx 4 14 -1e+37 1e+37 0 0 empty empty empty 0 -8 0 10
-262144 -1 -1 -6 256;
#X obj 77 343 nbx 4 14 -1e+37 1e+37 0 0 empty empty empty 0 -8 0 10
-262144 -1 -1 0 256;
#X connect 0 0 22 1;
#X connect 0 0 33 0;
#X connect 1 0 15 0;
#X connect 1 0 26 0;
#X connect 2 0 1 0;
#X connect 3 0 1 1;
#X connect 4 0 5 1;
#X connect 4 0 6 0;
#X connect 5 0 7 0;
#X connect 5 0 7 1;
#X connect 13 0 1 2;
#X connect 15 0 22 0;
#X connect 16 0 15 1;
#X connect 16 0 17 0;
#X connect 21 0 22 3;
#X connect 21 0 35 0;
#X connect 22 0 18 0;
#X connect 22 0 28 0;
#X connect 23 0 22 0;
#X connect 24 0 23 0;
#X connect 27 0 22 2;
#X connect 27 0 34 0;
#X connect 28 0 5 0;
#X connect 29 0 19 0;
